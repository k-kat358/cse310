{% extends 'base.html' %}
{% block content %}
<h1>{{ blog.title }}</h1>
<p>{{ blog.content }}</p>
<p>By {{ blog.author.username }} | {{ blog.created }}</p>

<!-- Like Button -->
<form action="{% url 'like_blog' blog.id %}" method="post">
    {% csrf_token %}
    {% if request.user in blog.likes.all %}
        <button type="submit">Unlike</button>
    {% else %}
        <button type="submit">Like</button>
    {% endif %}
</form>
<p>{{ blog.likes.count }} likes</p>

<!-- Comments Section -->
<h3>Comments:</h3>
<ul>
    {% for comment in blog.comment_set.all %}
        <li>
            <p>
                <strong>{{ comment.author.username }}</strong>: {{ comment.content }} 
                <small>({{ comment.created|date:"M d, Y H:i" }})</small>
            </p>
            <p>
                {% if request.user == comment.author %}
                    <a href="{% url 'edit_comment' comment.id %}" class="btn btn-sm btn-primary">Edit</a>
                    <a href="{% url 'delete_comment' comment.id %}" class="btn btn-sm btn-danger">Delete</a>
                {% endif %}
            </p>
        </li>
    {% endfor %}
</ul>
<!-- Add a Comment -->
<h3>Add a Comment:</h3>
<form action="{% url 'add_comment' blog.id %}" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Post Comment</button>
</form>
{% endblock %}